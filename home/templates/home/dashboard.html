{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Dashboard</h1>

    <!-- KPI Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="kpi-card bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-600">Total Records (This Month)</h2>
            <p id="kpi-total-records" class="text-3xl font-bold text-blue-500">Loading...</p>
        </div>
        <div class="kpi-card bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-600">Average Symptom Severity</h2>
            <p id="kpi-avg-severity" class="text-3xl font-bold text-orange-500">Loading...</p>
        </div>
        <div class="kpi-card bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold text-gray-600">Medication Adherence</h2>
            <p id="kpi-med-adherence" class="text-3xl font-bold text-green-500">Loading...</p>
        </div>
    </div>

    <!-- Main Chart Panels -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="chart-panel bg-white p-4 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">Records by Category</h2>
            <div class="flex flex-col lg:flex-row lg:flex-wrap gap-4 mb-4">
                <div>
                    <label for="healthCategoryFilter" class="block text-sm font-medium text-gray-700">Health Category:</label>
                    <select id="healthCategoryFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">All Categories</option>
                        {% for category in health_categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="diseaseCategoryFilter" class="block text-sm font-medium text-gray-700">Disease Category:</label>
                    <select id="diseaseCategoryFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">All Diseases</option>
                        {% for disease in disease_categories %}
                        <option value="{{ disease.id }}">{{ disease.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">Type:</label>
                    <label class="text-sm">
                        <input type="radio" name="records_by_category_type" value="count" checked class="mr-1">
                        Count
                    </label>
                    <label class="text-sm">
                        <input type="radio" name="records_by_category_type" value="latest" class="mr-1">
                        Latest
                    </label>
                    <label class="text-sm">
                        <input type="radio" name="records_by_category_type" value="individual" class="mr-1">
                        Individual
                    </label>
                </div>
                <div class="flex items-end space-x-2">
                    <button class="bg-gray-200 px-3 py-1 rounded text-sm" data-days="7">Last 7 Days</button>
                    <button class="bg-gray-200 px-3 py-1 rounded text-sm" data-days="30">Last 30 Days</button>
                    <button class="bg-gray-200 px-3 py-1 rounded text-sm" data-days="90">Last 90 Days</button>
                    <input type="date" id="recordsByCategoryStartDate" class="border rounded px-2 py-1 text-sm">
                    <span class="text-sm">to</span>
                    <input type="date" id="recordsByCategoryEndDate" class="border rounded px-2 py-1 text-sm">
                    <button id="recordsByCategoryApplyDate" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">Apply</button>
                </div>
            </div>
            <canvas id="recordsByCategoryChart"></canvas>
        </div>
        <div class="chart-panel bg-white p-4 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">Symptom Severity Trends</h2>
            <canvas id="symptomSeverityTrendsChart"></canvas>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
{% endblock extra_js %}
